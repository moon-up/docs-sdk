# MoonSigner

`MoonSigner` is an [Ethers signer](https://docs.ethers.org/v5/api/signer/#Signer) works with Moon’s wallet infrastructure..

“A **Signer** in \*ethers\* is an abstraction of an Ethereum Account, which can be used to sign messages and transactions and send signed transactions to the Ethereum Network to execute state changing operations.” -Ethers docs

**TLDR:** MoonSigner is mainly for **signing**, **creating**, and **sending transactions** over the blockchain

### Configuration:

Below is an example of how to configure `MoonSigner` for a project:

<pre class="language-typescript"><code class="lang-typescript">import { MoonSigner, MoonSignerConfig } from '@moonup/ethers';
<strong>const moonSignerConfig: MoonSignerConfig = {
</strong>  SDK: new MoonSDK(),
  address: '0x...',
  chainId: 1
};
const moonSigner = new MoonSigner(moonSignerConfig);
</code></pre>

### Example usage:

Below is an example of a `MoonSigner` instance:

```tsx
import { Typed, TypedDataDomain, TypedDataField } from '@moonup/ethers';
import { TransactionRequest } from '@ethersproject/abstract-provider';
import { BytesLike, arrayify } from '@ethersproject/bytes';
import { Provider } from '@ethersproject/abstract-provider';
import { BigNumber } from 'ethers';

// Update config
moonSigner.updateConfig(moonSignerConfig);

// Connect
const provider: Provider = ...; // replace with actual provider
moonSigner.connect(provider);

// Sign typed data
const domain: TypedDataDomain = {
  name: 'name',
  version: 'version',
  chainId: 1,
  verifyingContract: '0x...'
};
const types: Record<string, TypedDataField[]> = {
  EIP712Domain: [
    { name: 'name', type: 'string' },
    { name: 'version', type: 'string' },
    { name: 'chainId', type: 'uint256' },
    { name: 'verifyingContract', type: 'address' }
  ]
};
const value: Record<string, string> = {
  name: 'name',
  version: 'version'
};
const signature = await moonSigner.signTypedData(domain, types, value);

// Get address
const address = await moonSigner.getAddress();

// Sign message
const message: BytesLike = '0x...'; // replace with actual message
const signedMessage = await moonSigner.signMessage(message);

// Broadcast transaction
const signedTransaction: string = '0x...'; // replace with actual signed transaction
const transactionHash = await moonSigner.broadcastTransaction(signedTransaction);

// Send transaction
const transaction: TransactionRequest = {
  to: '0x...', // replace with actual address
  value: BigNumber.from(1),
  gasPrice: BigNumber.from(1),
  gasLimit: BigNumber.from(21000),
  nonce: 0,
  data: '0x...'
};
const transactionResponse = await moonSigner.sendTransaction(transaction);

// Sign transaction
const signedTransaction = await moonSigner.signTransaction(transaction);

// Get typed data domain
const typedDataDomain = await moonSigner.getTypedDataDomain('name', 'version', 1, '0x...');

// Get typed data
const typedData: Typed = await moonSigner.getTypedData(domain, types, value);
```

### MoonSigner Class

#### `constructor(config: MoonSignerConfig, provider?: Provider)`

Creates a new instance of the MoonSigner class.

#### `_signTypedData(domain: TypedDataDomain, types: Record<string, TypedDataField[]>, value: Record<string, any>): Promise<string>`

Signs typed data.

#### `updateConfig(config: MoonSignerConfig): void`

Updates the signer configuration.

#### `connect(provider: Provider): Signer`

Connects the signer to a provider.

#### `signTypedData(domain: TypedDataDomain, types: Record<string, TypedDataField[]>, value: Record<string, string>): Promise<string>`

Signs a typed data object.

#### `getAddress(): Promise<string>`

Returns the address of the signer.

#### `signMessage(message: BytesLike): Promise<string>`

Signs a message.

#### `broadcastTransaction(signedTransaction: string): Promise<string>`

Broadcasts a signed transaction.

#### `sendTransaction(transaction: TransactionRequest): Promise<TransactionResponse>`

Sends a transaction.

#### `transactionRequestToInputBody(tx: TransactionRequest): InputBody`

Converts a transaction request to an input body.

#### `moonTransactionResponseToTransactions(tx: Transaction): TransactionData[]`

Converts a moon transaction response to transaction data.

#### `signTransaction(transaction: TransactionRequest): Promise<string>`

Signs a transaction.

#### `getTypedDataDomain(name: string, version: string, chainId: number, verifyingContract: string): Promise<TypedDataDomain>`

Returns a typed data domain.

#### `getTypedData(domain: TypedDataDomain, types: Record<string, Array<TypedDataField>>, message: Record<string, string>): Promise<Typed>`

Returns typed data.
