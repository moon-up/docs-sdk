# MoonProvider

## Usage:

`MoonProvider` is an [Ethers provider](https://docs.ethers.org/v5/api/providers/provider/) that works with Moon’s wallet infrastructure.

“A **Provider** in ethers is a read-only abstraction to access the blockchain data.” -Ethers docs

**TLDR:** MoonProvider is mainly for **read-only** operations for interacting with the blockchain

### Configuration

Below is an example of how to configure `MoonProvider` for a project:

```tsx
import { MoonProvider, MoonProviderOptions} from '@moonup/ethers';
import { MoonSDK } from '@moonup/moon-sdk'; 

// Function to initialize MoonProvider
export const initializeMoonProvider = (moon: MoonSDK, address: string): MoonProvider => {
  const options: MoonProviderOptions = {
    chainId: 1891, //Lightlink ChainID
    SDK: moon,
    address: address
  };
  const moonEthersProvider = new MoonProvider(options);
  return moonEthersProvider;
};
```

### Example usage

Below is an example of a `MoonProvider` instance:

```tsx
import { MoonProvider, MoonProviderOptions } from '@moonup/ethers';
import { MoonSDK } from '@moonup/moon-sdk';
import { RequestArguments } from 'eip1193-provider';

// Create an instance of the MoonProvider class
const moonProviderOptions: MoonProviderOptions = {
  chainId: 1,
  SDK: new MoonSDK(),
  address: '0x...'
};
const moonProvider = new MoonProvider(moonProviderOptions);

// Request method
const requestArgs: RequestArguments = {
  method: 'eth_requestAccounts',
  params: []
};
const response = await moonProvider.request(requestArgs);

// Update config
moonProvider.updateConfig(moonProviderOptions);

// Connect
await moonProvider.connect();

// Disconnect
await moonProvider.disconnect();

// Send async
moonProvider.sendAsync(requestArgs, (error, response) => {
  if (error) {
    console.error(error);
  } else {
    console.log(response);
  }
});

// Enable
const accounts = await moonProvider.enable();

// Check if it's a MoonProvider
const isMoonProvider = moonProvider.isMoonProvider();

// Get chain id
const chainId = moonProvider.getChainId();

// Get signer
const signer = moonProvider.getSigner();

// Get network
const network = await moonProvider.getNetwork();

// Get block number
const blockNumber = await moonProvider.getBlockNumber();

// Get gas price
const gasPrice = await moonProvider.getGasPrice();

// Get balance
const balance = await moonProvider.getBalance('0x...');

// Get transaction count
const transactionCount = await moonProvider.getTransactionCount('0x...');

// Get code
const code = await moonProvider.getCode('0x...');

// Get storage at
const storage = await moonProvider.getStorageAt('0x...', 0);

// Send transaction
const transactionResponse = await moonProvider.sendTransaction('0x...');

// Call
const transaction = {
  to: '0x...',
  data: '0x...'
};
const callResponse = await moonProvider.call(transaction);

// Estimate gas
const gasEstimate = await moonProvider.estimateGas(transaction);

// Get block
const block = await moonProvider.getBlock('latest');

// Get block with transactions
const blockWithTransactions = await moonProvider.getBlockWithTransactions('latest');

// Get transaction
const transactionResponse = await moonProvider.getTransaction('0x...');

// Get transaction receipt
const receipt = await moonProvider.getTransactionReceipt('0x...');

// Get logs
const filter = {
  address: '0x...',
  topics: []
};
const logs = await moonProvider.getLogs(filter);

// Resolve name
const resolvedName = await moonProvider.resolveName('example.eth');

// Lookup address
const lookedUpAddress = await moonProvider.lookupAddress('0x...');

// Emit
moonProvider.emit('block', block);

// Listener count
const listenerCount = moonProvider.listenerCount('block');

// Listeners
const listeners = moonProvider.listeners('block');

// Remove all listeners
moonProvider.removeAllListeners('block');

// Wait for transaction
const receipt = await moonProvider.waitForTransaction('0x...');

// On
moonProvider.on('block', (block) => {
  console.log(block);
});

// Once
moonProvider.once('block', (block) => {
  console.log(block);
});

// Off
moonProvider.off('block');
```

### MoonProvider class

#### `constructor(options: MoonProviderOptions)`

Creates a new instance of the MoonProvider class.

#### `request(args: RequestArguments): Promise<any>`

Sends a JSON-RPC request.

#### `updateConfig(options: MoonProviderOptions): void`

Updates the provider configuration.

#### `connect(): Promise<void>`

Establishes a connection.

#### `disconnect(): Promise<void>`

Closes the established connection.

#### `sendAsync(args: RequestArguments, callback: (error: Error | null, response: any) => void): void`

Sends an asynchronous request.

#### `enable(): Promise<ProviderAccounts>`

Enables the provider.

#### `isMoonProvider(): boolean`

Checks if the provider is a MoonProvider.

#### `getChainId(): number`

Returns the current chain ID.

#### `getSigner(): MoonSigner`

Returns the signer.

#### `getNetwork(): Promise<Network>`

Returns the current network.

#### `getBlockNumber(): Promise<number>`

Returns the current block number.

#### `getGasPrice(): Promise<BigNumber>`

Returns the current gas price.

#### `getBalance(addressOrName: string | Promise<string>, blockTag?: BlockTag | Promise<BlockTag> | undefined): Promise<BigNumber>`

Returns the balance of the specified address.

#### `getTransactionCount(addressOrName: string | Promise<string>, blockTag?: BlockTag | Promise<BlockTag> | undefined): Promise<number>`

Returns the transaction count of the specified address.

#### `getCode(addressOrName: string | Promise<string>, blockTag?: BlockTag | Promise<BlockTag> | undefined): Promise<string>`

Returns the code at the specified address.

#### `getStorageAt(addressOrName: string | Promise<string>, position: BigNumberish | Promise<BigNumberish>, blockTag?: BlockTag | Promise<BlockTag> | undefined): Promise<string>`

Returns the storage at the specified position of the specified address.

#### `sendTransaction(signedTransaction: string | Promise<string>): Promise<TransactionResponse>`

Sends a signed transaction.

#### `call(transaction: Deferrable<TransactionRequest>, blockTag?: BlockTag | Promise<BlockTag> | undefined): Promise<string>`

Makes a call to the specified transaction.

#### `estimateGas(transaction: Deferrable<TransactionRequest>): Promise<BigNumber>`

Estimates the gas for the specified transaction.

#### `getBlock(blockHashOrBlockTag: BlockTag | Promise<BlockTag>): Promise<Block>`

Returns the block with the specified hash or tag.

#### `getBlockWithTransactions(blockHashOrBlockTag: BlockTag | Promise<BlockTag>): Promise<BlockWithTransactions>`

Returns the block with the specified hash or tag, including its transactions.

#### `getTransaction(transactionHash: string): Promise<TransactionResponse>`

Returns the transaction with the specified hash.

#### `getTransactionReceipt(transactionHash: string): Promise<TransactionReceipt>`

Returns the receipt of the transaction with the specified hash.

#### `getLogs(filter: Filter): Promise<Log[]>`

Returns the logs that match the specified filter.

#### `resolveName(name: string | Promise<string>): Promise<string | null>`

Resolves the specified name to an address.

#### `lookupAddress(address: string | Promise<string>): Promise<string | null>`

Looks up the name of the specified address.

#### `emit(eventName: EventType, ...args: any[]): boolean`

Emits an event.

#### `listenerCount(eventName?: EventType | undefined): number`

Returns the number of listeners for the specified event.

#### `listeners(eventName?: EventType | undefined): Listener[]`

Returns the listeners for the specified event.

#### `removeAllListeners(eventName?: EventType | undefined): Provider`

Removes all listeners for the specified event.

#### `waitForTransaction(transactionHash: string, confirmations?: number | undefined, timeout?: number | undefined): Promise<TransactionReceipt>`

Waits for the transaction with the specified hash to be mined.

#### `on(eventName: EventType, listener: Listener): Provider`

Adds a listener for the specified event.

#### `once(eventName: EventType, listener: Listener): Provider`

Adds a one-time listener for the specified event.

#### `off(eventName: EventType, listener?: Listener | undefined): Provider`

Removes a listener for the specified event.
